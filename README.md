# README

## 1) Скачайте (клонируйте) репозиторий

### Вариант А. Через кнопки на GitHub

1. Откройте страницу репозитория в браузере.
2. Нажмите **Code** → **Download ZIP**.
3. Распакуйте ZIP в удобную папку (например, на Рабочий стол).

### Вариант Б. Через команду `git clone` (если установлен Git)

1. Откройте **Terminal** (macOS/Linux) или **Командную строку / PowerShell** (Windows).
2. Введите команду (замените ссылку на реальную ссылку репозитория):

   ```bash
   git clone https://github.com/ВАШ_АККАУНТ/ВАШ_РЕПОЗИТОРИЙ.git
   ```
3. Перейдите в папку проекта:

   ```bash
   cd ВАШ_РЕПОЗИТОРИЙ
   ```

> Если вы никогда не пользовались Git — проще воспользоваться вариантом А (скачать ZIP).

---

## 2) Установите Python

Нужен **Python 3.9+** (рекомендуется 3.10 или новее).

* **Windows**:

  1. Зайдите на сайт [python.org/downloads](https://www.python.org/downloads/).
  2. Скачайте последнюю версию для Windows.
  3. При установке **обязательно поставьте галочку** «**Add Python to PATH**».
* **macOS**:

  * Проще всего установить через официальный установщик с [python.org](https://www.python.org/downloads/).
* **Linux (Ubuntu/Debian)**:

  ```bash
  sudo apt update
  sudo apt install -y python3 python3-pip
  ```

Проверьте установку:

```bash
python --version
```

или

```bash
python3 --version
```

Если видите что-то вроде `Python 3.11.x` — всё хорошо.

---

## 3) Откройте папку проекта в терминале

Если вы скачивали ZIP и распаковали его, откройте терминал/командную строку и перейдите в папку проекта. Примеры:

* **Windows (PowerShell)**:

  ```powershell
  cd "C:\Users\Вася\Desktop\ВАШ_РЕПОЗИТОРИЙ"
  ```
* **macOS/Linux (Terminal)**:

  ```bash
  cd ~/Desktop/ВАШ_РЕПОЗИТОРИЙ
  ```

---

## 4) (Необязательно) Создайте виртуальную среду

Это помогает держать нужные библиотеки отдельно и не «ломать» систему.

```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# macOS/Linux
python3 -m venv .venv
source .venv/bin/activate
```

После активации в начале строки терминала появится `(.venv)`.

---

## 5) Установите необходимые библиотеки

Проект использует **NumPy** и **Matplotlib**.

```bash
# В активированной среде .venv (или в системе, если без venv)
pip install --upgrade pip
pip install numpy matplotlib
```

> Если команда `pip` не работает, попробуйте `pip3`.

---

## 6) Подготовьте файлы настроек и выборок

В корне проекта (там же, где лежат `main.py` и `validate.py`) должны лежать:

### 6.1) `config.json`

Содержит путь к папке с данными (вашими `.npz` файлами). **Путь — относительный**, считается **от папки, где лежит `main.py`**.

Пример:

```json
{
  "data_folder_path": "data"
}
```

В этом примере скрипт будет искать файлы в папке `data`, которая должна быть рядом с `main.py`.
Если ваши данные лежат глубже, можно указать подкаталог, например:

```json
{
  "data_folder_path": "data/raw_npz"
}
```

### 6.2) `selections.json`

Содержит перечень файлов и индексы начала/конца импульсов. Пример структуры:

```json
[
  {
    "file_name": "file/abc/wow/AlN_ccurrent_50Ohm_1600V_30kHz_000181.npz",
    "batch_size": 600,
    "overlap_size": 50,
    "selections": [
      { "start_index": 6621, "end_index": 6641 },
      { "start_index": 6661, "end_index": 6680 }
    ]
  },
  {
    "file_name": "file/cde/wow/AlN_ccurrent_50Ohm_1600V_30kHz_000182.npz",
    "batch_size": 600,
    "overlap_size": 50,
    "selections": [
      { "start_index": 7548, "end_index": 7565 },
      { "start_index": 7567, "end_index": 7586 },
      { "start_index": 7589, "end_index": 7630 }
    ]
  }
]
```

**Важно:** наш скрипт **заменяет любой префикс** в `file_name` (например, `file/abc/wow/`) на путь из `config.json`, но **имя файла** берёт из конца строки.
То есть, если в `file_name` указан файл `.../000181.npz`, скрипт будет искать именно `data_folder_path/000181.npz`.

Положите сами `.npz` файлы (указанные в `selections.json`) в папку, заданную `data_folder_path`.
Например, если `data_folder_path` = `data`, то файлы должны лежать так:

```
проект/
  main.py
  validate.py
  config.json
  selections.json
  data/
    000181.npz
    000182.npz
    ...
```

---

## 7) Запустите основной скрипт и получите `pulses.txt`

Этот шаг извлечёт импульсы из ваших файлов и сохранит их в текстовый файл.

```bash
# Windows
python main.py

# macOS/Linux
python3 main.py
```

Что произойдёт:

* Скрипт прочитает `config.json` → найдёт папку с данными.
* Откроет `selections.json` → список файлов и наборы индексов.
* Для каждого файла загрузит массив `data` из `.npz` и извлечёт:

  * `t = data[0]` (время)
  * `v = data[1]` (напряжение)
  * `i = data[2]` (ток)
* По каждой паре индексов (`start_index`, `end_index`) вырежет импульс.
* Сохранит все импульсы в файл `pulses.txt` рядом со скриптом.

**Формат `pulses.txt`:**

```
time\tcurrent\tvoltage
start\t\t
0.00\t0.5\t100
0.01\t0.6\t98
...
start\t\t
...
```

Строка `start` отделяет импульсы друг от друга. Внутри импульса время начинается с 0.

---

## 8) Постройте графики и проверьте данные

Запустите валидатор, чтобы увидеть графики «ток от времени» для каждого импульса:

```bash
# Windows
python validate.py

# macOS/Linux
python3 validate.py
```

Откроются окна с графиками (по одному графику на импульс). Если графиков нет — смотрите раздел «Ошибки и их решения».

---

## 9) Частые ошибки и их решения

1. **`pulses.txt not found`** при запуске `validate.py`
   — Вы не запускали `main.py` или он завершился с ошибкой.
   **Решение:** Сначала выполните шаг 7.

2. **`File not found`** / «Файл не найден» в выводе `main.py`
   — Имя `.npz` в `selections.json` и реальное имя файла в папке `data_folder_path` не совпадают.
   **Решение:** Убедитесь, что файлы действительно лежат в папке, указанной в `config.json`, и их имена совпадают (например, `000181.npz`).

3. **`'data' array not found`**
   — В `.npz` нет массива с ключом `data`.
   **Решение:** Проверьте структуру ваших `.npz`. Должен быть массив `data` с тремя рядами: `data[0]` — время, `data[1]` — напряжение, `data[2]` — ток.

4. **Пустые графики или «No pulses found»**
   — В `selections.json` нет корректных пар индексов или индексы выходят за пределы массива.
   **Решение:** Проверьте `start_index` / `end_index`. В проекте индексы **включительные** (второй индекс тоже попадает в импульс).

5. **Проблемы с установкой библиотек (`pip` не найден)**
   — Попробуйте `pip3` вместо `pip`, или убедитесь, что Python добавлен в PATH (Windows).
   **Решение:** Переустановите Python с галочкой «Add Python to PATH».

6. **Графики не показываются** (особенно на сервере/удалённой машине)
   — Нужен режим с графическим интерфейсом.
   **Решение:** Запускайте на компьютере с рабочим столом/окнами, либо адаптируйте `validate.py` для сохранения изображений в файлы (мы можем помочь, напишите нам).

---

## 10) Дополнительно: как изменить точность чисел

Если хотите, чтобы в `pulses.txt` числа имели фиксированное число знаков после запятой, это легко настроить в `main.py`. Мы уже выводим «как есть». Можно заменить строку записи, например, на:

```python
out.write(f"{t_rel[k]:.6f}\t{i_seg[k]:.6f}\t{v_seg[k]:.6f}\n")
```

Это даст 6 знаков после запятой.

---

## 11) Структура проекта (что где лежит)

```
проект/
  main.py          # основной скрипт: читает .npz и формирует pulses.txt
  validate.py      # валидатор: строит графики по pulses.txt
  config.json      # настройки (относительный путь к папке с данными)
  selections.json  # список файлов и выборки индексов импульсов
  pulses.txt       # результат работы main.py (создаётся после запуска)
  data/            # сюда положите ваши .npz (имена должны совпадать)
```

---
